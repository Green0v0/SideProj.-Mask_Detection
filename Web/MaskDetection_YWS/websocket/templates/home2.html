<!DOCTYPE HTML>
<html>
<head>
    <title>Streamer</title>
</head>
<body>
    <video autoplay hidden=true></video>
    <img src="">
    <div id="myProgress">
      <div id="myBar">
        <div id="label">10%</div>
      </div>
    </div>
    <br>
    <button onclick="move()">Click Me</button> 

    <style>
        #myProgress {
            position: relative;
            width: 100%;
            height: 30px;
            background-color: grey;
        }
        #myBar {
            position: absolute;
            width: 1%;
            height: 100%;
            background-color: green;
        }
        #label {
            text-align: center; /* If you want to center it */
            line-height: 30px; /* Set the line-height to the same as the height of the progress bar container, to center it vertically */
            color: white;
        }
    </style>


    <script type = "text/javascript">
    
        const video = document.querySelector('video');
        const img = document.querySelector('img');
        navigator.mediaDevices.getUserMedia({video: {width: 640, height: 480}})
        .then((stream) => video.srcObject = stream);

        const getFrame = () => {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            const data = canvas.toDataURL('image/png');
            return data;
        }

        const WS_URL = 'ws://localhost:5502/ws';   // <<<<<<< 이 부분 port번호 맞추기
        const FPS = 3;
        const ws = new WebSocket(WS_URL);

        ws.onopen = () => {
            console.log(`Connected to ${WS_URL}`);
            setInterval(() => {
                ws.send(getFrame());
            }, 1000 / FPS);
        }

        ws.onmessage = message => {
            // set the base64 string to the src tag of the image
            img.src = message.data //.substring(0,message.data.length-3);
            console.log(img.src)
        }

        /*
        여기까지 확보!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        */
        var timerID;
        function move() {
            var elem = document.getElementById("myBar");
            var width = 10;
            var id = setInterval(frame, 10);

            function frame() {
                if (width >= 100) {
                    clearInterval(id);
                } else {
                    width++;
                    elem.style.width = width + '%';
                    document.getElementById("label").innerHTML = width * 1 + '%';
                }
            };
        }
        //     // $.ajax({
        //     //     xhr: function() {
        //     //         var xhr = new window.XMLHttpRequest();
        //     //         xhr.upload.addEventListener("progress", function(evt) {
        //     //             if (evt.lengthComputable) {
        //     //                 var percentComplete = Math.floor((evt.loaded / evt.total) * 100);
 
        //     //                 /* Do something with upload progress here */
        //     //                 var percentVal = percentComplete + '%';
        //     //                 bar.width(percentVal);
        //     //                 percent.html(percentVal);
 
        //     //             }
        //     //         }, false);
        //     //         return xhr;
        //     //     },
        //     //     type : 'POST',
        //     //     url : getContextPath() + "/admin/board/insertboard.do",
        //     //     dataType: 'text',
        //     //     data : formData,
        //     //     processData : false,
        //     //     contentType : false,
        //     //     success:function(result, status) {
        //     //         alert("저장 되었습니다.");
        //     //         location.href = getContextPath() + "/admin/board/boardList.do?";
        //     //     }
        //     // });

    </script>

    
    <!-- <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"
            style="width: 50%;">
            <span class="sr-only">45% Complete</span>
        </div>
    </div> -->
</body>
</html>